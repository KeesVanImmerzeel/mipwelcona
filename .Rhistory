sl_fltr_table ,
conc_streamlines)
conc
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
sl_fltr_table
fltr_nr
fltr_nr <- 2
sl_fltr_table %>% dplyr::filter(FLTR_NR == fltr_nr)
sl_fltr_table %>% dplyr::filter(FLTR_NR == fltr_nr) %>% dplyr::select(-c(FLTR_NR))
sl_fltr_table %>% dplyr::filter(FLTR_NR == fltr_nr) %>% dplyr::select(-c(FLTR_NR)) %>% dplyr::pull(1)
sl_nrs <-
sl_fltr_table %>% dplyr::filter(FLTR_NR == fltr_nr) %>% dplyr::select(-c(FLTR_NR)) %>% dplyr::pull(1)
sl_nrs
conc_streamlines
dplyr::filter( conc_streamlines$SL_NR %in% sl_nrs)
dplyr::filter( conc_streamlines, SL_NR %in% sl_nrs)
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
sl_fltr_table
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
load_all()
conc <-
purrrlyr::by_row(well_fltrs %>% as.data.frame(),
..f = .mw_conc_fltr,
sl_fltr_table ,
conc_streamlines)
x <- mapply(.mw_conc_fltr, well_fltrs, MoreArgs=list(sl_fltr_table, conc_streamlines),
USE.NAMES=FALSE)
load_all()
x <- mapply(.mw_conc_fltr, well_fltrs, MoreArgs=list(sl_fltr_table, conc_streamlines),
USE.NAMES=FALSE)
x
x <- apply(well_fltrs %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines)
x
x <- apply(well_fltrs %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>% as.data.frame()
x
x <- apply(well_fltrs %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines)
x <- apply(well_fltrs %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>% rbind()
x
x <- apply(well_fltrs %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines)
?rbindlist
x <- apply(well_fltrs %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>% rbindlist()
library(data.table)
x <- apply(well_fltrs %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>% data.table::rbindlist()
x
str(x)
well_fltrs
well_fltrs
well_fltrs=chk_mw_read_well_filters
sl_fltr_table[98,]$FLTR_NR <- 2
sl_fltr_table[99,]$FLTR_NR <- 2
sl_fltr_table[100,]$FLTR_NR <- 2
well_nrs <- well_fltrs %>%  dplyr::filter(WL_NR == well_nr) %>% dplyr::pull(FLTR_NR)
well_nrs
x <- apply(well_nrs %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines)
%>% data.table::rbindlist()
x <- apply(well_nrs %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist()
x
well_fltrs
well_fltrs %<>%  dplyr::filter(WL_NR == well_nr) %>% dplyr::pull(FLTR_NR)
well_fltrs
well_fltrs=chk_mw_read_well_filters
sl_fltr_table[98,]$FLTR_NR <- 2
sl_fltr_table[99,]$FLTR_NR <- 2
sl_fltr_table[100,]$FLTR_NR <- 2
well_fltrs %<>%  dplyr::filter(WL_NR == well_nr) %>% dplyr::pull(FLTR_NR)
well_fltrs
well_fltrs=chk_mw_read_well_filters
sl_fltr_table[98,]$FLTR_NR <- 2
sl_fltr_table[99,]$FLTR_NR <- 2
sl_fltr_table[100,]$FLTR_NR <- 2
well_fltrs %<>%  dplyr::filter(WL_NR == well_nr)
well_fltrs
str(well_fltrs$FLTR_NR)
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist()
x
well_fltrs
dplyr::left_join(x,well_fltrs)
well_fltrs %<>%  dplyr::filter(WL_NR == well_nr) %>% select(c(FLTR_NR,WL_NR,Q_FLTR))
well_fltrs
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist()
x
dplyr::left_join(x,well_fltrs)
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(x,well_fltrs)
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs)
x
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR")
x
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME)
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME)
dplyr::summarise(WCONC = weighted.mean(CONC, Q_FLTR))
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(WCONC = weighted.mean(CONC, Q_FLTR))
x
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
#dplyr::group_by(TIME) %>%
dplyr::summarise(WCONC = weighted.mean(CONC, Q_FLTR))
x
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
#dplyr::group_by(TIME) %>%
dplyr::summarise(WCONC = weighted.mean(CONC, Q_FLTR))
x
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(WCONC = weighted.mean(CONC, Q_FLTR))
?summarise()
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(WCONC = weighted.mean(CONC, Q_FLTR),.groups="drop")
x
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(WCONC = weighted.mean(CONC, Q_FLTR),.groups="drop")
x
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(WCONC = weighted.mean(CONC, Q_FLTR),.groups="drop") %>%
dplyr::mutate(WL_NR=well_nr) %>%
dplyr::relocate(WL_NR)
x
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(CONC = weighted.mean(CONC, Q_FLTR),.groups="drop") %>%
dplyr::mutate(WL_NR=well_nr) %>%
dplyr::relocate(WL_NR)
return(conc)
x <- apply(well_fltrs$FLTR_NR %>% as.array(), 1, .mw_conc_fltr, sl_fltr_table, conc_streamlines) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(CONC = weighted.mean(CONC, Q_FLTR),.groups="drop") %>%
dplyr::mutate(WL_NR=well_nr) %>%
dplyr::relocate(WL_NR)
x
load_all()
document()
install.packages("rtools")
library(devtools)
load_all()
writeLines('PATH="${RTOOLS40_HOME}\\usr\\bin;${PATH}"', con = "~/.Renviron")
Sys.which("make")
library(devtools)
load_all()
chk_mw_conc_fltr
chk_mw_conc_fltr <- .mw_conc_fltr(
fltr_nr = 1,
sl_fltr_table = chk_sl_fltr_table,
conc_streamlines = chk_mw_conc_streamlines
)
.mw_conc_fltr(
+     fltr_nr = 1,
+     sl_fltr_table = chk_sl_fltr_table,
+     conc_streamlines = chk_mw_conc_streamlines
+ )
.mw_conc_fltr(
fltr_nr = 1,
sl_fltr_table = chk_sl_fltr_table,
conc_streamlines = chk_mw_conc_streamlines
)
.mw_conc_fltr(
fltr_nr = 1,
sl_fltr_table = chk_sl_fltr_table,
conc_streamlines = chk_mw_conc_streamlines
)
.mw_conc_fltr(
fltr_nr = 1,
sl_fltr_table = chk_sl_fltr_table,
conc_streamlines = chk_mw_conc_streamlines
)
.mw_conc_fltr(
fltr_nr = 1,
sl_fltr_table = chk_sl_fltr_table,
conc_streamlines = chk_mw_conc_streamlines
)
.mw_conc_fltr(
fltr_nr = 1,
sl_fltr_table = chk_sl_fltr_table,
conc_streamlines = chk_mw_conc_streamlines
)
.mw_conc_fltr(
fltr_nr = 1,
sl_fltr_table = chk_sl_fltr_table,
conc_streamlines = chk_mw_conc_streamlines
)
sl_fltr_table <- chk_sl_fltr_table
sl_fltr_table[98,]$FLTR_NR <- 2
sl_fltr_table[99,]$FLTR_NR <- 2
sl_fltr_table[100,]$FLTR_NR <- 2
chk_mw_conc_well <- .mw_conc_well( well_nr=1, well_fltrs=chk_mw_read_well_filters, sl_fltr_table=chk_sl_fltr_table,
conc_streamlines=chk_mw_conc_streamlines )
sl_fltr_table <- chk_sl_fltr_table
sl_fltr_table[98,]$FLTR_NR <- 2
sl_fltr_table[99,]$FLTR_NR <- 2
sl_fltr_table[100,]$FLTR_NR <- 2
sl_fltr_table
well_fltrs %<>%  dplyr::filter(WL_NR == well_nr) %>% dplyr::select(c(FLTR_NR, WL_NR, Q_FLTR))
chk_mw_read_well_filters
well_fltrs=chk_mw_read_well_filters; sl_fltr_table=chk_sl_fltr_table;
conc_streamlines=chk_mw_conc_streamlines
well_fltrs %<>%  dplyr::filter(WL_NR == well_nr) %>% dplyr::select(c(FLTR_NR, WL_NR, Q_FLTR))
well_nr <- 1
well_fltrs %<>%  dplyr::filter(WL_NR == well_nr) %>% dplyr::select(c(FLTR_NR, WL_NR, Q_FLTR))
well_fltrs
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
)
sl_fltr_table[98,]$FLTR_NR <- 2
sl_fltr_table[99,]$FLTR_NR <- 2
sl_fltr_table[100,]$FLTR_NR <- 2
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
)
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
) %>%
data.table::rbindlist()
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR")
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME)
conc <-
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(CONC = weighted.mean(CONC, Q_FLTR), .groups =
"drop")
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(CONC = weighted.mean(CONC, Q_FLTR), .groups =
"drop")
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(CONC = weighted.mean(CONC, Q_FLTR), .groups =
"drop") %>%
dplyr::mutate(WL_NR = well_nr)
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(CONC = weighted.mean(CONC, Q_FLTR), .groups =
"drop") %>%
dplyr::mutate(WL_NR = well_nr) %>%
dplyr::relocate(WL_NR)
load_all()
rm(list = c("chk_mw_conc_fltr"))
load_all()
chk_mw_conc_well <- .mw_conc_well( well_nr=1, well_fltrs=chk_mw_read_well_filters, sl_fltr_table=chk_sl_fltr_table,
conc_streamlines=chk_mw_conc_streamlines )
chk_mw_conc_well <- .mw_conc_well( well_nr=1, well_fltrs=chk_mw_read_well_filters,
sl_fltr_table=sl_fltr_table, conc_streamlines=chk_mw_conc_streamlines )
chk_mw_conc_well
.mw_conc_well( well_nr=1, well_fltrs=chk_mw_read_well_filters,
sl_fltr_table=chk_sl_fltr_table, conc_streamlines=chk_mw_conc_streamlines )
sl_fltr_table=chk_sl_fltr_table
well_fltrs %<>%  dplyr::filter(WL_NR == well_nr) %>% dplyr::select(c(FLTR_NR, WL_NR, Q_FLTR))
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
)
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
) %>%
data.table::rbindlist()
na.omit.list <- function(y) { return(y[!sapply(y, function(x) all(is.na(x)))]) }
conc <-
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
)
conc
na.omit.list(conc)
conc %<>% na.omit.list(conc) %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(CONC = weighted.mean(CONC, Q_FLTR), .groups =
"drop") %>%
dplyr::mutate(WL_NR = well_nr) %>%
dplyr::relocate(WL_NR)
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(CONC = weighted.mean(CONC, Q_FLTR), .groups =
"drop") %>%
dplyr::mutate(WL_NR = well_nr) %>%
dplyr::relocate(WL_NR)
conc %<>% na.omit.list() %>%
data.table::rbindlist() %>%
dplyr::left_join(well_fltrs, by = "FLTR_NR") %>%
dplyr::group_by(TIME) %>%
dplyr::summarise(CONC = weighted.mean(CONC, Q_FLTR), .groups =
"drop") %>%
dplyr::mutate(WL_NR = well_nr) %>%
dplyr::relocate(WL_NR)
conc
load_all()
rm(list = c("na.omit.list"))
load_all()
sl_fltr_table <- chk_sl_fltr_table
sl_fltr_table[98,]$FLTR_NR <- 2
sl_fltr_table[99,]$FLTR_NR <- 2
sl_fltr_table[100,]$FLTR_NR <- 2
chk_mw_conc_well <- .mw_conc_well( well_nr=1, well_fltrs=chk_mw_read_well_filters,
sl_fltr_table, conc_streamlines=chk_mw_conc_streamlines )
chk_mw_conc_well
sl_fltr_table <- chk_sl_fltr_table
sl_fltr_table[98,]$FLTR_NR <- 2
sl_fltr_table[99,]$FLTR_NR <- 2
sl_fltr_table[100,]$FLTR_NR <- 2
.mw_conc_well( well_nr=1, well_fltrs=chk_mw_read_well_filters,
sl_fltr_table, conc_streamlines=chk_mw_conc_streamlines )
chk_mw_conc_well
sl_fltr_table <- chk_sl_fltr_table
sl_fltr_table[98,]$FLTR_NR <- 2
sl_fltr_table[99,]$FLTR_NR <- 2
sl_fltr_table[100,]$FLTR_NR <- 2
chk_mw_conc_well <- .mw_conc_well( well_nr=1, well_fltrs=chk_mw_read_well_filters,
sl_fltr_table, conc_streamlines=chk_mw_conc_streamlines )
usethis::use_data(chk_mw_read_streamlines,
chk_mw_read_well_filters,
chk_sl_fltr_table,
chk_mw_init,
chk_mw_conc_streamlines,
chk_mw_conc_fltr,
chk_mw_conc_well,
overwrite = TRUE,
internal = TRUE)
document()
rm(list = c("chk_mw_conc_well"))
document()
use_package("data.table")
conc
well_fltrs
sl_fltr_table
well_fltrs=chk_mw_read_well_filters
conc_streamlines=chk_mw_conc_streamlines
well_fltrs %<>%  dplyr::filter(WL_NR == well_nr) %>% dplyr::select(c(FLTR_NR, WL_NR, Q_FLTR))
well_fltrs
conc <-
apply(
well_fltrs$FLTR_NR %>% as.array(),
1,
.mw_conc_fltr,
sl_fltr_table,
conc_streamlines
)
conc
length(conc)
conc
conc[[1]]
conc[[1]]
conc[[1]] <- NA
conc[[1]]
conc[[2]] <- na
conc[[2]] <- NA
conc %<>% na.omit.list() # Remove results when no concentrations are available
length(conc)
length(conc)==0
fname <- system.file("extdata","streamlines.iff",package="mipwelcona")
strm_lns <- mw_read_streamlines(fname)
strm_lns
x <- mw_init(strm_lns, conc_l_lev=mw_example_conc_layer_levels(),
conc_l=mw_example_concentrations())
x
